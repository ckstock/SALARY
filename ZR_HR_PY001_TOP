*&---------------------------------------------------------------------*
*&  包含                ZR_HR_PY001_TOP
*&---------------------------------------------------------------------*
TABLES: PERNR,HRP1000.
INFOTYPES:0001,0002,0000,0185,0009,0008.

DATA: IT_OBJEC TYPE TABLE OF OBJEC WITH HEADER LINE.
DATA: IT_STRUC TYPE TABLE OF STRUC WITH HEADER LINE.
DATA:IT_RESULT_TAB TYPE TABLE OF  SWHACTOR WITH HEADER LINE.
DATA:IT_RESULT_STRUC TYPE TABLE OF STRUC WITH HEADER LINE.
DATA: IT_RANG TYPE RANGE OF HRP1000-OBJID WITH HEADER LINE.
DATA: G_BEGDA TYPE SY-DATUM,         "日期
      G_ENDDA TYPE SY-DATUM.

DATA: G_BEGDA1 TYPE SY-DATUM,
      G_ENDDA1 TYPE SY-DATUM.

TYPE-POOLS ICON.
DATA FUNCTXT TYPE SMP_DYNTXT.
TABLES: SSCRFIELDS.


DATA  G_LINES TYPE I.
DATA: R1 TYPE I.

DATA: HSFW TYPE T549T-ATEXT.

DATA:G_NUMBER LIKE PC261-SEQNR.

DATA:BEGIN OF T_RGDIR OCCURS 0.
        INCLUDE STRUCTURE PC261.
DATA: END OF T_RGDIR.

DATA:G_RESULT TYPE PAYCN_RESULT.
DATA:LT_RT TYPE LINE OF HRPAY99_RT.

DATA DANWEI TYPE STRING.

DATA:BEGIN OF GT_TITLE_DATA OCCURS 0,
       CHECKBOX(2),
       NUM         TYPE ZLGART-ZNUM,
       LGART       LIKE ZLGART-ZGZXMBM,
       LGTXT       LIKE ZLGART-ZGZXMWB,
       BETRG       LIKE PA0008-ANSAL, "金额
       NUM1        TYPE  ZLGART-ZNUM,
     END OF GT_TITLE_DATA.

DATA:BEGIN OF GT_MIAN_DATA OCCURS 0,
       HSFW   TYPE T549T-ATEXT,       "核算范围
       NUMBER TYPE I,                 "序号
       PERNR  TYPE PERNR-PERNR,       "人员编号
       NACHN  TYPE PA0002-NACHN,      "姓名
       ICNUM  TYPE PA0185-ICNUM,      "身份证号
       BKREF  TYPE PA0009-BKREF,      "银行卡号
       GANGW  TYPE STRING,            "岗位
       ZHIWX  TYPE STRING,            "职务小类
       ZHIWD  TYPE STRING,            "职务大类
       TRFGR  TYPE PA0008-TRFGR,      "岗级
       TRFST  TYPE PA0008-TRFST,      "薪档
       ORG1   TYPE STRING,            "一级部门
       ORG2   TYPE STRING,            "二级部门
       ORG3   TYPE STRING,            "三级部门
       ORG4   TYPE STRING,            "四级部门
       ORG5   TYPE STRING,            "五级部门
       RT559  TYPE PA0008-ANSAL,      "实发工资
       RT101  TYPE PA0008-ANSAL,      "应发工资
       ZINX   TYPE I,
     END OF GT_MIAN_DATA.
DATA:SOBID LIKE HRP1001-SOBID,SCLAS LIKE HRP1001-SCLAS.

DATA:BEGIN OF GT_BETRG OCCURS 0.
DATA:PERNR LIKE PERNR-PERNR.
DATA:BETRG LIKE PA0008-ANSAL.  "金额
        INCLUDE STRUCTURE ZLGART.
DATA:END OF GT_BETRG .
DATA:GT_BETRG1 LIKE TABLE OF GT_BETRG WITH HEADER LINE.
DATA:GT_BETRG2 LIKE TABLE OF GT_BETRG WITH HEADER LINE.

*DATA:BEGIN OF hj_itab OCCURS 0,
*  zgzxmbm LIKE zlgart-zgzxmbm,
*  betrg LIKE pa0008-ansal, "金额
*  END OF hj_itab.

DATA:LT_ZLGART    LIKE TABLE OF ZLGART WITH HEADER LINE,
     LT_ZLGART1   LIKE TABLE OF ZLGART1 WITH HEADER LINE,
     LT_ZLGART1_1 LIKE TABLE OF ZLGART1 WITH HEADER LINE.

FIELD-SYMBOLS: <DYN_TABLE>  TYPE STANDARD TABLE,<DYN_TABLE1> TYPE STANDARD TABLE,
               <DYN_WA>,<DYN_WA1>,
               <DYN_FIELD>,<DYN_FIELD1>.

DATA: DY_TABLE     TYPE REF TO DATA,
      DY_LINE      TYPE REF TO DATA,
      IT_STRUCTURE TYPE LVC_T_FCAT,
      WA_STRUCTURE TYPE LVC_S_FCAT.

DATA:BEGIN OF IT_PERNR OCCURS 0,
       OBJID LIKE OBJEC-OBJID,
       SUM1  TYPE I,
     END   OF IT_PERNR.

DATA:BEGIN OF IT_HRP1001 OCCURS 0,
       OBJID TYPE HRP1001-OBJID,
       SOBID TYPE HRP1001-SOBID,
       PROZT TYPE HRP1001-PROZT,
     END OF IT_HRP1001.


SELECTION-SCREEN BEGIN OF BLOCK B1 WITH FRAME TITLE TEXT-001.
PARAMETERS:P_OBJID LIKE HRP1000-OBJID .
SELECTION-SCREEN END OF BLOCK B1.

SELECTION-SCREEN BEGIN OF BLOCK B2 WITH FRAME TITLE TEXT-002.
PARAMETERS: 01P01 TYPE C AS CHECKBOX .
PARAMETERS: 02P02 TYPE C AS CHECKBOX .
PARAMETERS: 03P03 TYPE C AS CHECKBOX .
PARAMETERS: 04P04 TYPE C AS CHECKBOX .
PARAMETERS: 05P05 TYPE C AS CHECKBOX .
SELECTION-SCREEN END OF BLOCK B2 .

DATA: GT_VIMSELLIST TYPE STANDARD TABLE OF VIMSELLIST,
      GW_VIMSELLIST TYPE                   VIMSELLIST.

SELECTION-SCREEN: FUNCTION KEY 2.

DATA:OK_CODE LIKE SY-UCOMM.
DATA:WCL_CONTAINER TYPE REF TO CL_GUI_CUSTOM_CONTAINER, "存放ALV的容器
     WCL_GRID      TYPE REF TO CL_GUI_ALV_GRID,             "ALV的网格
     GT_FIELDCAT   TYPE LVC_T_FCAT ,      "存放字段目录的内表
     GS_LAYOUT     TYPE LVC_S_LAYO .                       "布局结构

DATA:WCL_CONTAINER1 TYPE REF TO CL_GUI_CUSTOM_CONTAINER,
     WCL_GRID1      TYPE REF TO CL_GUI_ALV_GRID,
     GT_FIELDCAT1   TYPE LVC_T_FCAT,  GT_FIELDCAT2 TYPE LVC_T_FCAT,
     GS_LAYOUT1     TYPE LVC_S_LAYO.
DATA: W_DOC      TYPE REF TO CL_DD_DOCUMENT,
      W_SPLITTER TYPE REF TO CL_GUI_SPLITTER_CONTAINER,
      W_VIEWER   TYPE REF TO CL_GUI_HTML_VIEWER,
      W_HEAD     TYPE REF TO CL_GUI_CONTAINER,
      W_BODY     TYPE REF TO CL_GUI_CONTAINER.

CLASS LCL_EVENT_RECEIVER DEFINITION DEFERRED.   "增加菜单按钮
DATA:GO_RECEIVER TYPE REF TO LCL_EVENT_RECEIVER."增加菜单按钮

CLASS LCL_EVENT_RECEIVER1 DEFINITION DEFERRED.   "增加菜单按钮
DATA:GO_RECEIVER1 TYPE REF TO LCL_EVENT_RECEIVER1."增加菜单按钮

CLASS LCL_EVENT_RECEIVER DEFINITION.
  PUBLIC SECTION.

    METHODS:
      HANDLE_TOOLBAR
                    FOR EVENT TOOLBAR OF CL_GUI_ALV_GRID
        IMPORTING E_OBJECT E_INTERACTIVE,

      HANDLE_USER_COMMAND
                    FOR EVENT USER_COMMAND OF CL_GUI_ALV_GRID
        IMPORTING E_UCOMM,
      HANDLE_F4
                    FOR EVENT ONF4 OF CL_GUI_ALV_GRID
        IMPORTING E_FIELDNAME
                    ES_ROW_NO
                    ER_EVENT_DATA
                    ET_BAD_CELLS,
      HANDLE_DATA_CHANGED
                    FOR EVENT DATA_CHANGED OF CL_GUI_ALV_GRID
        IMPORTING ER_DATA_CHANGED.
ENDCLASS.
CLASS LCL_EVENT_RECEIVER IMPLEMENTATION.
  METHOD HANDLE_TOOLBAR.

    DATA: LS_TOOLBAR  TYPE STB_BUTTON.
    CLEAR LS_TOOLBAR.

    MOVE 3 TO LS_TOOLBAR-BUTN_TYPE.
    APPEND LS_TOOLBAR TO E_OBJECT->MT_TOOLBAR.

*    CLEAR ls_toolbar.
*    MOVE 'SAVE' TO ls_toolbar-function.
*    MOVE ICON_SYSTEM_SAVE TO ls_toolbar-icon.
*    MOVE '保存工资项目' TO ls_toolbar-quickinfo.
*    MOVE '保存工资项目' TO ls_toolbar-text.
*    APPEND ls_toolbar TO e_object->mt_toolbar.

    MOVE 3 TO LS_TOOLBAR-BUTN_TYPE.
    APPEND LS_TOOLBAR TO E_OBJECT->MT_TOOLBAR.

    CLEAR LS_TOOLBAR.
    MOVE 'INSERT' TO LS_TOOLBAR-FUNCTION.
    MOVE ICON_CHANGE_TEXT TO LS_TOOLBAR-ICON.
    MOVE '生成' TO LS_TOOLBAR-QUICKINFO.
    MOVE '生成' TO LS_TOOLBAR-TEXT.
    APPEND LS_TOOLBAR TO E_OBJECT->MT_TOOLBAR.

  ENDMETHOD.                    "handle_toolbar
  METHOD HANDLE_USER_COMMAND.
    PERFORM HANDLE_USER_COMMAND USING E_UCOMM."新增功能的功能编写
  ENDMETHOD.
  METHOD HANDLE_F4.

  ENDMETHOD.
  METHOD HANDLE_DATA_CHANGED.
    CALL METHOD WCL_GRID->REFRESH_TABLE_DISPLAY.
  ENDMETHOD.
ENDCLASS.               "lcl_event_receiver

CLASS LCL_EVENT_RECEIVER1 DEFINITION.
  PUBLIC SECTION.

    METHODS:
      HANDLE_TOOLBAR
                    FOR EVENT TOOLBAR OF CL_GUI_ALV_GRID
        IMPORTING E_OBJECT E_INTERACTIVE,

      HANDLE_USER_COMMAND
                    FOR EVENT USER_COMMAND OF CL_GUI_ALV_GRID
        IMPORTING E_UCOMM,
      HANDLE_DATA_CHANGED
                    FOR EVENT DATA_CHANGED OF CL_GUI_ALV_GRID
        IMPORTING ER_DATA_CHANGED.

ENDCLASS.               "lcl_event_receiver1

CLASS LCL_EVENT_RECEIVER1 IMPLEMENTATION.
  METHOD HANDLE_TOOLBAR.

    DATA: LS_TOOLBAR  TYPE STB_BUTTON.
    CLEAR LS_TOOLBAR.

    MOVE 3 TO LS_TOOLBAR-BUTN_TYPE.
    APPEND LS_TOOLBAR TO E_OBJECT->MT_TOOLBAR.
    CLEAR LS_TOOLBAR.
    MOVE 'EXCEL' TO LS_TOOLBAR-FUNCTION.
    MOVE  ICON_XXL TO LS_TOOLBAR-ICON.
    MOVE 'EXCEL导出' TO LS_TOOLBAR-QUICKINFO.
    MOVE 'EXCEL导出' TO LS_TOOLBAR-TEXT.
    APPEND LS_TOOLBAR TO E_OBJECT->MT_TOOLBAR.
  ENDMETHOD.                    "handle_toolbar
  METHOD HANDLE_USER_COMMAND.
    PERFORM HANDLE_USER_COMMAND1 USING E_UCOMM.
  ENDMETHOD.
  METHOD HANDLE_DATA_CHANGED.
    CALL METHOD WCL_GRID1->REFRESH_TABLE_DISPLAY.
  ENDMETHOD.
ENDCLASS.               "lcl_event_receiver1



DATA:ABKRS LIKE P0001-ABKRS.
DATA:HEJI TYPE I VALUE 0.

DATA:ZHIWU_OBJEC TYPE TABLE OF OBJEC WITH HEADER LINE.

*********2015年11月17日修改
DATA:BEGIN OF LT_ABKRS OCCURS 0,
       PERNR LIKE PA0001-PERNR,
       ABKRS LIKE PA0001-ABKRS,
     END OF  LT_ABKRS.
